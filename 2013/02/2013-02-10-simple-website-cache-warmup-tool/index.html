<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Quick Web performance test script - Janne "Lietu" Enberg</title><meta name=twitter:card content="summary_large_image"><meta name=twitter:creator content="@lietux"><meta name=twitter:title content><meta name=twitter:description content><meta name=Description content><meta property="og:title" content="Quick Web performance test script"><meta property="og:description" content="PrefaceI was interested in testing out my new homepage server's performance in rather simple terms. I thought bombarding a single URL with Apache Benchmark would distort the results too much, and I also didn't want to load the resources outside my control (e.g. Google Analytics). I made a simple BASH script that loops indefinitely and does a wget call that fetches all the resources and links on my homepage recursively and displays the time it took to do that for each iteration."><meta property="og:type" content="article"><meta property="og:url" content="https://lietu.net/2013/02/2013-02-10-simple-website-cache-warmup-tool/"><meta property="article:section" content="post"><meta property="article:published_time" content="2013-02-10T00:00:00+00:00"><meta property="article:modified_time" content="2013-02-10T00:00:00+00:00"><meta name=application-name content="Janne &#34;Lietu&#34; Enberg"><meta name=apple-mobile-web-app-title content="Janne &#34;Lietu&#34; Enberg"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=icon type=image/png sizes=192x192 href=/android-chrome-192x192.png><link rel=icon type=image/png sizes=512x512 href=/android-chrome-512x512.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://lietu.net/2013/02/2013-02-10-simple-website-cache-warmup-tool/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/lib/prismjs/prism.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Quick Web performance test script","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/lietu.net\/2013\/02\/2013-02-10-simple-website-cache-warmup-tool\/"},"genre":"post","wordCount":350,"url":"https:\/\/lietu.net\/2013\/02\/2013-02-10-simple-website-cache-warmup-tool\/","datePublished":"2013-02-10T00:00:00+00:00","dateModified":"2013-02-10T00:00:00+00:00","description":""}</script></head><body data-header-desktop data-header-mobile><script>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'dark'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'dark'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header><div class="desktop header" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title='Janne "Lietu" Enberg' class="header-logo logo-svg">Janne "Lietu" Enberg</a></div><div class=menu><nav><h2 class=display-hidden>Основная навигация</h2><ul class=menu-inner><li><a class=menu-item href=/post/>Posts</a></li></ul></nav><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><span class="svg-icon icon-moon"></span></a></div></div></div><div class="mobile header" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title='Janne "Lietu" Enberg' class=header-logo>Janne "Lietu" Enberg</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><nav><h2 class=display-hidden>Основная навигация</h2><ul><li><a class=menu-item href=/post/ title>Posts</a></li></ul></nav><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><span class="svg-icon icon-moon"></span></a></div></div></div></header><main class=main><div class=container><div class="page single special"><h1 class="single-title pulse faster">Quick Web performance test script</h1><div class=content id=content><h4>Preface</h4><p>I was interested in testing out my new homepage server's performance in rather simple terms. I thought bombarding a single URL with Apache Benchmark would distort the results too much, and I also didn't want to load the resources outside my control (e.g. Google Analytics). I made a simple BASH script that loops indefinitely and does a wget call that fetches all the resources and links on my homepage recursively and displays the time it took to do that for each iteration.</p><h4>Code</h4><p>This simple shell script should work for on most platforms as long as you have "date" that supports "+%s.%N" -format, "wget" and "bc".</p><p><b>Update:</b> The previous version was actually broken and rather shit. Now here's a better one. First of all, the previous one actually failed to recursively fetch all of the pages. Also, now all URLs are processed in parallel to reduce the time it takes to warm up multiple pages.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=cp>#!/usr/bin/env bash
</span><span class=cp></span>
<span class=c1># URLs to warm up</span>
<span class=nv>urls</span><span class=o>=</span><span class=k>$(</span>cat <span class=s2>&#34;</span><span class=si>${</span><span class=nv>HOME</span><span class=si>}</span><span class=s2>/warmup_urls.txt&#34;</span><span class=k>)</span>

<span class=c1># Temp path for storing files fetched during warmup</span>
<span class=nv>temp_path</span><span class=o>=</span><span class=s2>&#34;/tmp/warmup.sh/&#34;</span>

<span class=c1># Command to warm them up with</span>
<span class=nv>warmup</span><span class=o>=</span><span class=s2>&#34;wget -rp -nv -q&#34;</span>
<span class=c1># If you want a slight delay between page loads to reduce load</span>
<span class=c1>#warmup=&#34;wget -rp -nv -q -w 1&#34;</span>

<span class=c1># ----- LOGIC ----- #</span>

<span class=c1># Function to warm up a single URL</span>
<span class=k>function</span> warmup_url<span class=o>()</span> <span class=o>{</span>
        <span class=nv>url</span><span class=o>=</span><span class=si>${</span><span class=nv>1</span><span class=si>}</span>

        <span class=nb>echo</span> <span class=s2>&#34;Warming up </span><span class=si>${</span><span class=nv>url</span><span class=si>}</span><span class=s2>...&#34;</span>

        <span class=c1># Build the full command to warm it up</span>
        <span class=nv>cmd</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>warmup</span><span class=si>}</span><span class=s2> </span><span class=si>${</span><span class=nv>url</span><span class=si>}</span><span class=s2>&#34;</span>

        <span class=c1># Run the command and time it</span>
        <span class=nv>start</span><span class=o>=</span><span class=k>$(</span>date +%s.%N<span class=k>)</span>
        <span class=si>${</span><span class=nv>cmd</span><span class=si>}</span>
        <span class=nv>end</span><span class=o>=</span><span class=k>$(</span>date +%s.%N<span class=k>)</span>

        <span class=nv>elapsed</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>end</span><span class=si>}</span><span class=s2>-</span><span class=si>${</span><span class=nv>start</span><span class=si>}</span><span class=s2>&#34;</span> <span class=p>|</span> bc<span class=k>)</span>

        <span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>url</span><span class=si>}</span><span class=s2> warmed up in </span><span class=si>${</span><span class=nv>elapsed</span><span class=si>}</span><span class=s2> seconds&#34;</span>
<span class=o>}</span>


<span class=c1># Make sure the temp path exists and go there</span>
mkdir -p <span class=si>${</span><span class=nv>temp_path</span><span class=si>}</span>
<span class=nb>cd</span> <span class=si>${</span><span class=nv>temp_path</span><span class=si>}</span>

<span class=c1># Loop through the URLs and warm them up in parallel</span>
<span class=nv>pids</span><span class=o>=</span><span class=s2>&#34;&#34;</span>
<span class=k>for</span> url in <span class=si>${</span><span class=nv>urls</span><span class=si>}</span><span class=p>;</span> <span class=k>do</span>
        warmup_url <span class=nv>$url</span> <span class=p>&amp;</span>
        <span class=c1># Save background process PID</span>
        <span class=nv>pids</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>pids</span><span class=si>}</span><span class=s2> </span><span class=nv>$!</span><span class=s2>&#34;</span>
<span class=k>done</span>

<span class=c1># Wait for the background processes to complete</span>
<span class=nb>wait</span> <span class=si>${</span><span class=nv>pids</span><span class=si>}</span>

<span class=c1># Get out of the temp path and remove it</span>
<span class=nb>cd</span> - &gt; /dev/null
rm -rf <span class=si>${</span><span class=nv>temp_path</span><span class=si>}</span></code></pre></div><p>Put the code in some file, a list of URLs in the path specified in the urls= -line, and run it with: ./somefile.sh</p></div></div></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.83.1">Hugo</a> | Theme - <a href="https://ublogger.netlify.app/?utm_source=https://lietu.net/&utm_medium=footer&utm_campaign=config&utm_term=2.0.1" target=_blank title="uBlogger 2.0.1">uBlogger</a></div><div class=footer-line><i class="svg-icon icon-copyright"></i><span>2021</span></div></div></footer></div><aside id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="svg-icon icon-arrow-up"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="svg-icon icon-comments-fixed"></i></a></aside><script src=/lib/smooth-scroll/smooth-scroll.min.js></script><script src=/lib/clipboard/clipboard.min.js></script><script>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{}}</script><script src=/js/theme.min.js></script></body></html>