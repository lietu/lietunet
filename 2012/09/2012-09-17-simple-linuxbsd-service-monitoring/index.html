<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Simple Linux/BSD service monitoring script - Janne "Lietu" Enberg</title><meta name=twitter:card content="summary_large_image"><meta name=twitter:creator content="@lietux"><meta name=twitter:title content><meta name=twitter:description content><meta name=Description content><meta property="og:title" content="Simple Linux/BSD service monitoring script"><meta property="og:description" content="Here's a simple script to monitor the status of a service via a normal control script such as /etc/init.d/varnishd as commonly found under Linux and BSD based systems .. it should be super simple to modify for most other types of systems, such as systemctl.
Just configure, place somewhere on the server, and set a crontab line to run it every now and then.
#!/usr/bin/env bash  # ----- ------------- ----- # # ----- CONFIGURATION ----- # # ----- ------------- ----- # # Path to control script (usually in rc."><meta property="og:type" content="article"><meta property="og:url" content="https://lietu.net/2012/09/2012-09-17-simple-linuxbsd-service-monitoring/"><meta property="article:section" content="post"><meta property="article:published_time" content="2012-09-17T00:00:00+00:00"><meta property="article:modified_time" content="2012-09-17T00:00:00+00:00"><meta name=application-name content="Janne &#34;Lietu&#34; Enberg"><meta name=apple-mobile-web-app-title content="Janne &#34;Lietu&#34; Enberg"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=icon type=image/png sizes=192x192 href=/android-chrome-192x192.png><link rel=icon type=image/png sizes=512x512 href=/android-chrome-512x512.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://lietu.net/2012/09/2012-09-17-simple-linuxbsd-service-monitoring/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/lib/prismjs/prism.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Simple Linux/BSD service monitoring script","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/lietu.net\/2012\/09\/2012-09-17-simple-linuxbsd-service-monitoring\/"},"genre":"post","wordCount":182,"url":"https:\/\/lietu.net\/2012\/09\/2012-09-17-simple-linuxbsd-service-monitoring\/","datePublished":"2012-09-17T00:00:00+00:00","dateModified":"2012-09-17T00:00:00+00:00","description":""}</script></head><body data-header-desktop data-header-mobile><script>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'dark'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'dark'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header><div class="desktop header" id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title='Janne "Lietu" Enberg' class="header-logo logo-svg">Janne "Lietu" Enberg</a></div><div class=menu><nav><h2 class=display-hidden>Основная навигация</h2><ul class=menu-inner><li><a class=menu-item href=/post/>Posts</a></li></ul></nav><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><span class="svg-icon icon-moon"></span></a></div></div></div><div class="mobile header" id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title='Janne "Lietu" Enberg' class=header-logo>Janne "Lietu" Enberg</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><nav><h2 class=display-hidden>Основная навигация</h2><ul><li><a class=menu-item href=/post/ title>Posts</a></li></ul></nav><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><span class="svg-icon icon-moon"></span></a></div></div></div></header><main class=main><div class=container><div class="page single special"><h1 class="single-title pulse faster">Simple Linux/BSD service monitoring script</h1><div class=content id=content><p>Here's a simple script to monitor the status of a service via a normal control script such as /etc/init.d/varnishd as commonly found under Linux and BSD based systems .. it should be super simple to modify for most other types of systems, such as systemctl.</p><p>Just configure, place somewhere on the server, and set a crontab line to run it every now and then.</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=cp>#!/usr/bin/env bash
</span><span class=cp></span>
<span class=c1># ----- ------------- ----- #</span>
<span class=c1># ----- CONFIGURATION ----- #</span>
<span class=c1># ----- ------------- ----- #</span>

<span class=c1># Path to control script (usually in rc.d or init.d)</span>
<span class=nv>SERVICED</span><span class=o>=</span><span class=s2>&#34;/usr/local/etc/rc.d/varnishd&#34;</span>

<span class=c1># Who should get crash notifications</span>
<span class=nv>EMAIL_RECIPIENT</span><span class=o>=</span><span class=s2>&#34;recipient@example.com&#34;</span>

<span class=c1># Subject of the crash notification</span>
<span class=nv>EMAIL_SUBJECT</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>SERVICED</span><span class=si>}</span><span class=s2> crash detected&#34;</span>


<span class=c1># ----- ------------ ----- #</span>
<span class=c1># ----- SCRIPT LOGIC ----- #</span>
<span class=c1># ----- ------------ ----- #</span>

<span class=c1># Check status</span>
<span class=s2>&#34;</span><span class=si>${</span><span class=nv>SERVICED</span><span class=si>}</span><span class=s2>&#34;</span> status &gt; /dev/null 2&gt;<span class=p>&amp;</span><span class=m>1</span>
<span class=nv>service_status</span><span class=o>=</span><span class=nv>$?</span>

<span class=c1># Exit code will be 1 if varnish is not running</span>
<span class=k>if</span> <span class=o>[</span> <span class=nv>$service_status</span> -eq <span class=m>1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>

    <span class=nv>service_start_message</span><span class=o>=</span><span class=k>$(</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>SERVICED</span><span class=si>}</span><span class=s2>&#34;</span> start 2&gt;<span class=p>&amp;</span>1<span class=k>)</span>

    <span class=nv>host</span><span class=o>=</span><span class=k>$(</span>uname -n<span class=k>)</span>
    <span class=nv>uptime</span><span class=o>=</span><span class=k>$(</span>uptime<span class=k>)</span>

    <span class=nv>email_message</span><span class=o>=</span><span class=s2>&#34;Service </span><span class=si>${</span><span class=nv>SERVICED</span><span class=si>}</span><span class=s2> seems to have crashed on host </span><span class=si>${</span><span class=nv>host</span><span class=si>}</span><span class=s2>.
</span><span class=s2>
</span><span class=s2>Uptime:
</span><span class=s2></span><span class=si>${</span><span class=nv>uptime</span><span class=si>}</span><span class=s2>
</span><span class=s2>
</span><span class=s2>Messages from trying to restart it:
</span><span class=s2></span><span class=si>${</span><span class=nv>service_start_message</span><span class=si>}</span><span class=s2>
</span><span class=s2>&#34;</span>

    <span class=c1># Send email</span>
    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>email_message</span><span class=si>}</span><span class=s2>&#34;</span> <span class=p>|</span> mail -s<span class=s2>&#34;</span><span class=si>${</span><span class=nv>EMAIL_SUBJECT</span><span class=si>}</span><span class=s2>&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>EMAIL_RECIPIENT</span><span class=si>}</span><span class=s2>&#34;</span>

<span class=k>fi</span></code></pre></div></div></div></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.83.1">Hugo</a> | Theme - <a href="https://ublogger.netlify.app/?utm_source=https://lietu.net/&utm_medium=footer&utm_campaign=config&utm_term=2.0.1" target=_blank title="uBlogger 2.0.1">uBlogger</a></div><div class=footer-line><i class="svg-icon icon-copyright"></i><span>2021</span></div></div></footer></div><aside id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="svg-icon icon-arrow-up"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="svg-icon icon-comments-fixed"></i></a></aside><script src=/lib/smooth-scroll/smooth-scroll.min.js></script><script src=/lib/clipboard/clipboard.min.js></script><script>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:10},comment:{}}</script><script src=/js/theme.min.js></script></body></html>